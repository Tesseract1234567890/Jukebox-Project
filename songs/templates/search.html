<!DOCTYPE html>
{% load static %}
<html>
<head>
    <title>CatJam</title>
    <link rel = "stylesheet" href = "{% static 'css/styles.css' %}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>

<body>
    <div class="header">
        <h1>CatJam</h1>
    </div>
    <div class="search">
        <input type="text" id="searchbar" name="song" placeholder="Search for a song here:" onkeyup="printText(this)">
        <script>
            window.onload = function() {
                document.getElementById('searchbar').value = ""
                console.log("loaded")
            };
            function printText(input) {
                console.log(input.value);
                console.log("pressed key")
                if (event.keyCode === 13) {  // 13 is the key code for the Enter key
                    event.preventDefault();  // prevent form submission
                    var searchText = input.value;  // get the text from the search bar
                    console.log("pressed enter")
                    fetch('/search_for_tracks/?track_name=' + searchText)
                        .then(response => response.json())
                        .then(data => {
                            var dropdown = document.getElementById('dropdown');
                            dropdown.innerHTML = '';  // clear the previous results

                            for(var i = 0; i < data.result.length; i++) {
                                var track = data.result[i];

                                // Create a new div for the track
                                var item = document.createElement('div');
                                item.className = 'item';
                                item.onclick = function() {
                                    input.value = this.textContent;  // set the search bar value to the clicked item's text
                                    dropdown.classList.remove('show');  // hide the dropdown
                                };
                                
                                // Create an img element for the album cover
                                var img = document.createElement('img');
                                img.src = track.cover_url;  // replace with the actual album cover URL
                                item.appendChild(img);

                                // Create a new div for the text (song title and artist name)
                                var textWrapper = document.createElement('div');
                                textWrapper.style.display = 'flex';
                                textWrapper.style.flexDirection = 'column';

                                // Create a new div for the track name and append it to the text wrapper
                                var trackName = document.createElement('div');
                                trackName.textContent = track.track_name;
                                var trackLength = document.createElement('div');
                                trackLength.textContent = track.track_length;
                                trackLength.style.marginLeft = 'auto';  // align it to the right
                                trackName.appendChild(trackLength);
                                textWrapper.appendChild(trackName);

                                // Create a new div for the artist name and append it to the text wrapper
                                var artistName = document.createElement('div');
                                artistName.textContent = 'by ' + track.artist_name;
                                textWrapper.appendChild(artistName);

                                // Append the image and text wrapper to the item
                                item.appendChild(img);
                                item.appendChild(textWrapper);
                                // Add the item to the dropdown
                                dropdown.appendChild(item);
                            }
                            dropdown.style.display = 'block';
                        })
                        .catch(error => console.error('Error:', error));
                                }
                            }
            
        </script>
    </div>
    <div id="dropdown" aria-labelledby="searchbar"></div>
    <div class="results"></div>
</body>
</html>